version: '3.7'

services:
  ssh-to-docker-host:
    image: jnovack/autossh
    container_name: autossh-ssh-to-docker-host
    environment:
      - SSH_HOSTUSER=haytham
      - SSH_HOSTNAME=homelab.rootit.top
      - SSH_TUNNEL_REMOTE=5557
      - SSH_TUNNEL_HOST=app
      - SSH_TUNNEL_LOCAL=80
    restart: always
    volumes:
      - ./key/id_rsa:/id_rsa
    dns:
      - 8.8.8.8
      - 1.1.1.1
  app:
    image: jc21/nginx-proxy-manager:latest
    restart: always
    ports:
        # Public HTTP Port:
        - '80:80'
        # Public HTTPS Port:
        - '443:443'
        # Admin Web Port:
        - '81:81'
    environment:
        # Uncomment this if IPv6 is not enabled on your host
        DISABLE_IPV6: 'true'
    volumes:
        # Make sure this config.json file exists as per instructions above:
        - ./config.json:/app/config/production.json
        - ./data:/data
        - ./letsencrypt:/etc/letsencrypt
    depends_on:
        - db
  db:
    image: jc21/mariadb-aria:latest
    restart: always
    environment:
        MYSQL_ROOT_PASSWORD: 'npm'
        MYSQL_DATABASE: 'npm'
        MYSQL_USER: 'npm'
        MYSQL_PASSWORD: 'npm'
    volumes:
        - ./data/mysql:/var/lib/mysql